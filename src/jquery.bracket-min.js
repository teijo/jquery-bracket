"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},__extends=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();!function(t){function e(t){return!isNaN(parseFloat(t))&&isFinite(t)}function n(){this.message="Root of information for this team",this.name="EndOfBranchException"}function r(t){function e(t,n){return t instanceof Array?e(t[0],n+1):n}return e(t,0)}function i(t,e){return e>0&&(t=i([t],e-1)),t}function o(e,n,r){var i=r.find(".team[data-teamid="+e+"]"),o=n||"highlight";return{highlight:function(){i.each(function(){t(this).addClass(o),t(this).hasClass("win")&&t(this).parent().find(".connector").addClass(o)})},deHighlight:function(){i.each(function(){t(this).removeClass(o),t(this).parent().find(".connector").removeClass(o)})}}}function s(e,n,r){var i=r||n,s=i.winner(),a=i.loser();s&&a&&(s.name.isEmpty()||o(s.seed.get(),"highlightWinner",e).highlight(),a.name.isEmpty()||o(a.seed.get(),"highlightLoser",e).highlight()),e.find(".team").mouseover(function(){var n=t(this).attr("data-teamid");if(void 0!==n){var r=o(parseInt(n,10),null,e);r.highlight(),t(this).mouseout(function(){r.deHighlight(),t(this).unbind("mouseout")})}})}function a(e,n,r){var i=t('<input type="text">');i.val(n),e.empty().append(i),i.focus(),i.blur(function(){r(i.val())}),i.keydown(function(t){var e=t.keyCode||t.which;9!==e&&13!==e&&27!==e||(t.preventDefault(),r(i.val(),27!==e))})}function u(t,e,n,r){switch(r){case M.EMPTY_BYE:return void t.append("BYE");case M.EMPTY_TBD:return void t.append("TBD");case M.ENTRY_NO_SCORE:case M.ENTRY_DEFAULT_WIN:case M.ENTRY_COMPLETE:return void t.append(e)}}function c(t){var e=t.el;return e.find(".team.win").append('<div class="bubble">1st</div>'),e.find(".team.lose").append('<div class="bubble">2nd</div>'),!0}function h(t){var e=t.el;return e.find(".team.win").append('<div class="bubble third">3rd</div>'),e.find(".team.lose").append('<div class="bubble fourth">4th</div>'),!0}function l(t,e,n,r,i){for(var o,s=Math.log(2*e.length)/Math.log(2),a=e.length,u=0;u<s;u+=1){o=t.addRound(w.empty());for(var l=0;l<a;l+=1){var p=0===u?B(e,l):null;if(u===s-1&&n||u===s-1&&i){var d=o.addMatch(p,w.of(c));i||d.setAlignCb(N(d,r.skipConsolationRound))}else o.addMatch(p,w.empty())}a/=2}if(n&&(t.final().setConnectorCb(w.empty()),e.length>1&&!r.skipConsolationRound)){var f=t.final().getRound().prev(),m=f.map(function(t){return function(){return t.match(0).loser()}}).toNull(),g=f.map(function(t){return function(){return t.match(1).loser()}}).toNull(),b=o.addMatch(function(){return[{source:m},{source:g}]},w.of(h));b.setAlignCb(function(e){var n=t.el.height()/2;b.el.css("height",n+"px");var i=e.height()/2+r.matchMargin;e.css("top",i+"px")}),b.setConnectorCb(w.empty())}}function p(t,e,n,r,i){for(var o=Math.log(2*n)/Math.log(2)-1,s=n/2,a=0;a<o;a+=1){for(var u=r&&a===o-1?1:2,c=0;c<u;c+=1)for(var l=e.addRound(w.empty()),p=0;p<s;p+=1){var d=c%2!=0||0===a?D(t,e,s,p,c,a):null,f=a===o-1&&r,m=l.addMatch(d,w.of(f?h:null));if(m.setAlignCb(F(m.el.find(".teamContainer"),m)),f)m.setConnectorCb(w.empty());else if(a<o-1||c<1){var g=c%2==0?Y(i):null;m.setConnectorCb(w.of(g))}}s/=2}}function d(t,e,n,r,i,o){var s=t.addRound(w.empty()),a=s.addMatch(function(){return[{source:function(){return e.winner()}},{source:function(){return n.winner()}}]},w.of(function(i){var s=!1;if(r.skipSecondaryFinal||i.winner().name.isEmpty()||i.winner().name!==n.winner().name){if(2===t.size())t.dropRound();else if(t.size()>2)throw new Error("Unexpected number of final rounds");return c(i)}if(2===t.size())return!1;var a=function(){var e=!i.winner().name.isEmpty()&&i.winner().name===n.winner().name;return!1===s&&e&&(s=!0,o()),!e&&s&&(s=!1,t.dropRound(),o()),e},u=t.addRound(w.of(a)),h=u.addMatch(function(){return[{source:function(){return i.first()}},{source:function(){return i.second()}}]},w.of(c));return i.setConnectorCb(w.of(function(t){return{height:0,shift:t.height()/2}})),h.setConnectorCb(w.empty()),h.setAlignCb(function(t){var r=e.el.height()+n.el.height();h.el.css("height",r+"px");var i=(e.el.height()/2+e.el.height()+n.el.height()/2)/2-t.height();t.css("top",i+"px")}),!1}));if(a.setAlignCb(function(t){var i=e.el.height()+n.el.height();r.skipConsolationRound||(i/=2),a.el.css("height",i+"px");var o=(e.el.height()/2+e.el.height()+n.el.height()/2)/2-t.height();t.css("top",o+"px")}),!r.skipConsolationRound){var u=n.final().getRound().prev(),l=s.addMatch(function(){return[{source:function(){return u.get().match(0).loser()}},{source:function(){return n.loser()}}]},w.of(h));l.setAlignCb(function(t){var r=(e.el.height()+n.el.height())/2;l.el.css("height",r+"px");var i=(e.el.height()/2+e.el.height()+n.el.height()/2)/2+t.height()/2-r;t.css("top",i+"px")}),a.setConnectorCb(w.empty()),l.setConnectorCb(w.empty())}e.final().setConnectorCb(w.of(function(t){var i=t.height()/4,o=(e.el.height()/2+e.el.height()+n.el.height()/2)/2-t.height()/2,s=o-e.el.height()/2,a=e.winner().order.map(function(t){return t.map({height:s+2*i,shift:i*(r.centerConnectors?2:1)},{height:s+i*(r.centerConnectors?2:0),shift:i*(r.centerConnectors?2:3)})}).orElse({height:s+i*(r.centerConnectors?2:1),shift:2*i}),u=a.height,c=a.shift;return{height:u-t.height()/2,shift:c}})),n.final().setConnectorCb(w.of(function(t){var i=t.height()/4,o=(e.el.height()/2+e.el.height()+n.el.height()/2)/2-t.height()/2,s=o-e.el.height()/2,a=n.winner().order.map(function(t){return t.map({height:s+i*(r.centerConnectors?2:0),shift:i*(r.centerConnectors?2:3)},{height:s+2*i,shift:i*(r.centerConnectors?2:1)})}).orElse({height:s+i*(r.centerConnectors?2:1),shift:2*i}),u=a.height,c=a.shift;return{height:-(u+t.height()/2),shift:-c}}))}function f(t,e,n){return t.name.map(function(){return n.map(function(){return M.ENTRY_COMPLETE}).orElseGet(function(){return e.emptyBranch()===C.BYE?M.ENTRY_DEFAULT_WIN:M.ENTRY_NO_SCORE})}).orElseGet(function(){var e=t.emptyBranch();switch(e){case C.BYE:return M.EMPTY_BYE;case C.TBD:return M.EMPTY_TBD;default:throw new Error("Unexpected branch type "+e)}})}function m(e,n,r,i){var o=n.shift,s=A(n.height),a=s.height,u=s.drop,c=e/2,h=t('<div class="connector"></div>').appendTo(r);h.css("height",a),h.css("width",c+"px"),h.css(i,-c-2+"px"),o>=0?h.css("top",o-1+"px"):h.css("bottom",-o-1+"px"),u?h.css("border-bottom","none"):h.css("border-top","none");var l=t('<div class="connector"></div>').appendTo(h);return l.css("width",c+"px"),l.css(i,-c+"px"),u?l.css("bottom","0px"):l.css("top","0px"),h}function g(t,e,n,r,i){if(e)return Math.log(2*t)/Math.log(2);if(n)return Math.max(2,2*(Math.log(2*t)/Math.log(2)-1)-1);var o=!r&&3===i.length&&2===i[2].length;return 2*(Math.log(2*t)/Math.log(2)-1)+1+(o?1:0)}function b(e){var n=t.extend(!0,{},e);return n.teams=n.teams.map(function(t){return t.map(function(t){return t.toNull()})}),n.results=n.results.map(function(t){return t.map(function(t){return t.map(function(t){var e=[t.first.toNull(),t.second.toNull()];return void 0!==t.userData&&e.push(t.userData),e})})}),n}function y(n,r,i,o,s,a,u,c,h,l){var p=i.name.isEmpty()||o.name.isEmpty()?"":'data-resultid="result-'+c.getNext()+'"',d=t('<div class="score" style="width: '+u.scoreWidth+'px;" '+p+"></div>"),m=i.name.isEmpty()||o.name.isEmpty()||!s?w.empty():i.score.map(function(t){return""+t}),g=m.orElse("--");d.text(g);var b=t('<div class="team" style="width: '+(u.teamWidth+u.scoreWidth)+'px;"></div>'),y=t('<div class="label" style="width: '+u.teamWidth+'px;"></div>').appendTo(b);if(u.decorator.render(y,i.name.toNull(),g,f(i,o,m)),i.seed.forEach(function(t){b.attr("data-teamid",t)}),i.name.isEmpty()?b.addClass("na"):r.winner().name===i.name?b.addClass("win"):r.loser().name===i.name&&b.addClass("lose"),b.append(d),(!i.name.isEmpty()||i.name.isEmpty()&&0===n&&a)&&"function"==typeof u.save&&(u.disableTeamEdit||(y.addClass("editable"),y.click(function(){function e(){function o(o,s){var a=i.seed.get();u.init.teams[~~(a/2)][a%2]=w.of(o||null),l(!0),r.click(e);var c=u.el.find(".team[data-teamid="+(a+1)+"] div.label:first");c.length&&!0===s&&0===n&&t(c).click()}r.unbind(),u.decorator.edit(r,i.name.toNull(),o)}var r=t(this);e()})),!i.name.isEmpty()&&!o.name.isEmpty()&&s)){var v=c.get();d.addClass("editable"),d.click(function(){function n(){r.unbind();var o=e(i.score)?r.text():"0",s=t('<input type="text">');s.val(o),r.empty().append(s),s.focus().select(),s.keydown(function(n){e(t(this).val())?t(this).removeClass("error"):t(this).addClass("error");var r=n.keyCode||n.which;if(9===r||13===r||27===r){if(n.preventDefault(),t(this).blur(),27===r)return;var i=h.find("div.score[data-resultid=result-"+(v+1)+"]");i&&i.click()}}),s.blur(function(){var t=s.val();t&&e(t)||e(i.score)?t&&e(t)||!e(i.score)||(t=i.score):t="0",r.html(t),e(t)&&(i.score=E.of(parseInt(t,10)),l(!0)),r.click(n)})}var r=t(this);n()})}return b}function v(e,n,r){var i=t('<div class="tools"></div>').appendTo(e);(t('<span class="increment">+</span>').appendTo(i).click(function(){for(var t=n.teams.length,e=0;e<t;e+=1)n.teams.push([w.empty(),w.empty()]);return j(r)}),n.teams.length>1&&1===n.results.length||n.teams.length>2&&3===n.results.length)&&t('<span class="decrement">-</span>').appendTo(i).click(function(){if(n.teams.length>1)return n.teams=n.teams.slice(0,n.teams.length/2),j(r)});if(1===n.results.length&&n.teams.length>1){var o=t('<span class="doubleElimination">de</span>').appendTo(i);o.click(function(){if(n.teams.length>1&&n.results.length<3)return n.results.push([],[]),j(r)})}else if(3===n.results.length&&n.teams.length>1){var o=t('<span class="singleElimination">se</span>').appendTo(i);o.click(function(){if(3===n.results.length)return n.results=n.results.slice(0,1),j(r)})}}var C,w=function(){function t(e){if(this.val=e,e instanceof t)throw new Error("Trying to wrap Option into an Option");if(void 0===this.val)throw new Error("Option cannot contain undefined")}return t.of=function(e){return new t(e)},t.empty=function(){return new t(null)},t.prototype.get=function(){if(null===this.val)throw new Error("Trying to get() empty Option");return this.val},t.prototype.orElse=function(t){return null===this.val?t:this.val},t.prototype.orElseGet=function(t){return null===this.val?t():this.val},t.prototype.map=function(e){return null===this.val?t.empty():new t(e(this.val))},t.prototype.forEach=function(t){return null!==this.val&&t(this.val),this},t.prototype.toNull=function(){return null===this.val?null:this.val},t.prototype.isEmpty=function(){return null===this.val},t}(),E=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.of=function(e){var n=void 0===e?"undefined":_typeof(e);if(null!==e&&"number"!==n)throw new Error("Invalid score format, expected number, got "+n);return t.of.call(this,e)},e.empty=function(){return w.empty()},e}(w),k=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.of=function(e){var n=void 0===e?"undefined":_typeof(e);if(null!==e&&"number"!==n)throw new Error("Invalid score format, expected number, got "+n);return t.of.call(this,e)},e.empty=function(){return w.empty()},e}(w),T=function(){function t(t,e,n,r){if(this.first=t,this.second=e,this.winOrLose=n,this.userData=r,!t||!e)throw new Error("Cannot create ResultObject with undefined scores")}return t}();!function(t){t[t.TBD=0]="TBD",t[t.BYE=1]="BYE",t[t.END=2]="END"}(C||(C={}));var M,O=function(){function t(t){this.isFirst=t}return t.first=function(){return new t(!0)},t.second=function(){return new t(!1)},t.prototype.map=function(t,e){return this.isFirst?t:e},t}(),R=function(){function t(t,e,n,r,i){this.source=t,this.nameOrGetter=e,this.order=n,this.seed=r,this.score=i,this.sibling=function(){throw new Error("No sibling asigned")}}return Object.defineProperty(t.prototype,"name",{get:function(){return"function"==typeof this.nameOrGetter?this.nameOrGetter():this.nameOrGetter},set:function(t){this.nameOrGetter=t},enumerable:!0,configurable:!0}),t.prototype.emptyBranch=function(){if(!this.name.isEmpty())return this.sibling().name.isEmpty()?C.BYE:C.TBD;try{var t=this.source().emptyBranch();if(t===C.TBD)return C.TBD;if(t===C.END)return C.BYE;return this.source().sibling().emptyBranch()===C.TBD?C.TBD:C.BYE}catch(t){if(t instanceof n)return C.END;throw new Error('Unexpected exception type (message: "'+t.message+'")')}},t}(),x=function(){function t(t,e,n){this.a=t,this.b=e,this.winOrLose=n}return t.teamsInResultOrder=function(t){var e=t.a.name.isEmpty(),n=t.b.name.isEmpty(),r=t.winOrLose;if(!r.isEmpty()){return 1==r.get()?[t.a,t.b]:[t.b,t.a]}if(n&&!e)return t.b.emptyBranch()===C.BYE?[t.a,t.b]:[];if(e&&!n)return t.a.emptyBranch()===C.BYE?[t.b,t.a]:[];if(!t.a.score.isEmpty()&&!t.b.score.isEmpty()){if(t.a.score.get()>t.b.score.get())return[t.a,t.b];if(t.a.score.get()<t.b.score.get())return[t.b,t.a]}return[]},t.emptyTeam=function(t,e){var n=new R(t,w.empty(),w.empty(),w.empty(),E.empty());return n.sibling=function(){return e},n},t.prototype.winner=function(){return t.teamsInResultOrder(this)[0]||t.emptyTeam(this.a.source,this.b)},t.prototype.loser=function(){return t.teamsInResultOrder(this)[1]||t.emptyTeam(this.b.source,this.a)},t}();!function(t){t.EMPTY_BYE="empty-bye",t.EMPTY_TBD="empty-tbd",t.ENTRY_NO_SCORE="entry-no-score",t.ENTRY_DEFAULT_WIN="entry-default-win",t.ENTRY_COMPLETE="entry-complete"}(M||(M={}));var _=function(){throw new n},B=function(t,e){return function(){var n=new R(_,function(){return t[e][0]},w.of(O.first()),w.of(2*e),E.empty()),r=new R(_,function(){return t[e][1]},w.of(O.second()),w.of(2*e+1),E.empty());return n.sibling=function(){return r},r.sibling=function(){return n},[{source:function(){return n}},{source:function(){return r}}]}},N=function(t,e){return function(n){n.css("top",""),n.css("position","absolute"),e?n.css("top",t.el.height()/2-n.height()/2+"px"):n.css("bottom",-n.height()/2+"px")}},D=function(t,e,n,r,i,o){return function(){if(i%2==0&&0===o)return[{source:function(){return t.round(0).match(2*r).loser()}},{source:function(){return t.round(0).match(2*r+1).loser()}}];var s=o%2==0?n-r-1:r;return[{source:function(){return e.round(2*o).match(r).winner()}},{source:function(){return t.round(o+1).match(s).loser()}}]}},F=function(t,e){return function(){return t.css("top",e.el.height()/2-t.height()/2+"px")}},Y=function(t){return function(e,n){var r=e.height()/4,i={height:0,shift:2*r};return n.winner().order.map(function(e){return e.map(t?i:{height:0,shift:r},t?i:{height:2*-r,shift:r})}).orElse(i)}},W=function(){function e(e,n,r,i,o,s,a,u){this.bracket=e,this.previousRound=n,this.roundNumber=r,this.roundResults=i,this.doRenderCb=o,this.mkMatch=s,this.isFirstBracket=a,this.opts=u,this.containerWidth=this.opts.teamWidth+this.opts.scoreWidth,this.roundCon=t('<div class="round" style="width: '+this.containerWidth+"px; margin-right: "+this.opts.roundMargin+'px"/>'),this.matches=[]}return Object.defineProperty(e.prototype,"el",{get:function(){return this.roundCon},enumerable:!0,configurable:!0}),e.prototype.addMatch=function(t,e){var n=this,r=this.matches.length,i=null!==t?t():[{source:function(){return n.bracket.round(n.roundNumber-1).match(2*r).winner()}},{source:function(){return n.bracket.round(n.roundNumber-1).match(2*r+1).winner()}}],o=function(){return i[0].source()},s=function(){return i[1].source()},a=new R(o,o().name,w.of(O.first()),o().seed,E.empty()),u=new R(s,s().name,w.of(O.second()),s().seed,E.empty());a.sibling=function(){return u},u.sibling=function(){return a};var c=new x(a,u,k.empty()),h=this.mkMatch(this,c,r,this.roundResults.map(function(t){return void 0===t[r]?null:t[r]}),e,this.isFirstBracket,this.opts);return this.matches.push(h),h},e.prototype.match=function(t){return this.matches[t]},e.prototype.prev=function(){return this.previousRound},e.prototype.size=function(){return this.matches.length},e.prototype.render=function(){this.roundCon.empty(),(this.doRenderCb.isEmpty()||this.doRenderCb.get()())&&(this.roundCon.appendTo(this.bracket.el),this.matches.forEach(function(t){return t.render()}))},e.prototype.results=function(){return this.matches.reduce(function(t,e){return t.concat([e.results()])},[])},e}(),P=function(){function t(t,e,n,r,i){this.bracketCon=t,this.initResults=e,this.mkMatch=n,this.isFirstBracket=r,this.opts=i,this.rounds=[]}return Object.defineProperty(t.prototype,"el",{get:function(){return this.bracketCon},enumerable:!0,configurable:!0}),t.prototype.addRound=function(t){var e=this.rounds.length,n=e>0?w.of(this.rounds[e-1]):w.empty(),r=this.initResults.map(function(t){return void 0===t[e]?new T(E.empty(),E.empty(),void 0,void 0):t[e]}),i=new W(this,n,e,r,t,this.mkMatch,this.isFirstBracket,this.opts);return this.rounds.push(i),i},t.prototype.dropRound=function(){this.rounds.pop()},t.prototype.round=function(t){return this.rounds[t]},t.prototype.size=function(){return this.rounds.length},t.prototype.final=function(){return this.rounds[this.rounds.length-1].match(0)},t.prototype.winner=function(){return this.rounds[this.rounds.length-1].match(0).winner()},t.prototype.loser=function(){return this.rounds[this.rounds.length-1].match(0).loser()},t.prototype.render=function(){this.bracketCon.empty();for(var t=0,e=this.rounds;t<e.length;t++){e[t].render()}},t.prototype.results=function(){return this.rounds.reduce(function(t,e){return t.concat([e.results()])},[])},t}(),A=function(t){return t<0?{height:-t,drop:!1}:t<2?{height:0,drop:!0}:{height:t,drop:!0}},G=function(){function t(){this.counter=0}return t.prototype.get=function(){return this.counter},t.prototype.getNext=function(){return++this.counter},t.prototype.reset=function(){this.counter=0},t}(),L=function(){function n(n,r,i,o,s,a,u,c,h,l){if(this.round=n,this.match=r,this.seed=i,this.renderCb=s,this.isFirstBracket=a,this.opts=u,this.resultId=c,this.topCon=h,this.renderAll=l,this.connectorCb=w.empty(),this.matchCon=t('<div class="match"></div>'),this.teamCon=t('<div class="teamContainer"></div>'),this.alignCb=null,this.matchUserData=o.isEmpty()?void 0:o.get().userData,this.winOrLose=o.isEmpty()?void 0:o.get().winOrLose,!u.save){var p=this.matchUserData;u.onMatchHover&&this.teamCon.hover(function(){u.onMatchHover(p,!0)},function(){u.onMatchHover(p,!1)}),u.onMatchClick&&this.teamCon.click(function(){u.onMatchClick(p)})}r.a.name=r.a.source().name,r.b.name=r.b.source().name,r.a.score=o.map(function(t){return t.first.toNull()}),r.b.score=o.map(function(t){return t.second.toNull()}),r.winOrLose=o.map(function(t){return t.winOrLose.toNull()}),r.a.name&&r.b.name||!e(r.a.score)&&!e(r.b.score)||(console.warn("ERROR IN SCORE DATA: "+r.a.source().name+": "+r.a.score+", "+r.b.source().name+": "+r.b.score),r.a.score=r.b.score=E.empty())}return Object.defineProperty(n.prototype,"el",{get:function(){return this.matchCon},enumerable:!0,configurable:!0}),n.prototype.getRound=function(){return this.round},n.prototype.setConnectorCb=function(t){this.connectorCb=t},n.prototype.connect=function(t){var e=this,n="lr"===this.opts.dir?"right":"left",r=this.teamCon.height()/4,i=this.matchCon.height()/2,o=t.map(function(t){return t(e.teamCon,e)}).orElseGet(function(){return e.seed%2==0?e.winner().order.map(function(t){return t.map({height:i,shift:r*(e.opts.centerConnectors?2:1)},{height:i-r*(e.opts.centerConnectors?0:2),shift:r*(e.opts.centerConnectors?2:3)})}).orElse({height:i-r*(e.opts.centerConnectors?0:1),shift:2*r}):e.winner().order.map(function(t){return t.map({height:-i+r*(e.opts.centerConnectors?0:2),shift:-r*(e.opts.centerConnectors?2:3)},{height:-i,shift:-r*(e.opts.centerConnectors?2:1)})}).orElse({height:-i+r*(e.opts.centerConnectors?0:1),shift:2*-r})});this.teamCon.append(m(this.opts.roundMargin,o,this.teamCon,n))},n.prototype.winner=function(){return this.match.winner()},n.prototype.loser=function(){return this.match.loser()},n.prototype.getWinOrLose=function(){return this.winOrLose},n.prototype.first=function(){return this.match.a},n.prototype.second=function(){return this.match.b},n.prototype.setAlignCb=function(t){this.alignCb=t},n.prototype.render=function(){var t=this;this.matchCon.empty(),this.teamCon.empty(),this.match.a.name=this.match.a.source().name,this.match.b.name=this.match.b.source().name,this.match.a.seed=this.match.a.source().seed,this.match.b.seed=this.match.b.source().seed,this.match.a.name.isEmpty()&&this.match.b.name.isEmpty()?this.teamCon.addClass("np"):this.match.winner().name?this.teamCon.removeClass("np"):this.teamCon.addClass("np");var e=!this.match.a.name.isEmpty()&&!this.match.b.name.isEmpty();this.teamCon.append(y(this.round.roundNumber,this.match,this.match.a,this.match.b,e,this.isFirstBracket,this.opts,this.resultId,this.topCon,this.renderAll)),this.teamCon.append(y(this.round.roundNumber,this.match,this.match.b,this.match.a,e,this.isFirstBracket,this.opts,this.resultId,this.topCon,this.renderAll)),this.matchCon.appendTo(this.round.el),this.matchCon.append(this.teamCon),this.el.css("height",this.round.bracket.el.height()/this.round.size()+"px"),this.teamCon.css("top",this.el.height()/2-this.teamCon.height()/2+"px"),null!==this.alignCb&&this.alignCb(this.teamCon),this.renderCb.map(function(e){return e(t)}).orElse(!1)||this.connect(this.connectorCb)},n.prototype.results=function(){return(this.match.a.name.isEmpty()||this.match.b.name.isEmpty())&&(this.match.a.score=this.match.b.score=E.empty()),new T(this.match.a.score,this.match.b.score,this.winOrLose,this.matchUserData)},n}(),I=function(t){return void 0===t?null:t},S=function(t){return t.map(function(t){return t.map(function(t){return t.map(function(t){return new T(E.of(I(t[0])),E.of(I(t[1])),k.of(I(t[2])),t[3])})})})},j=function(e){function n(){var t=g(c.teams.length,h,e.skipGrandFinalComeback,e.skipSecondaryFinal,c.results);e.disableToolbar?m.css("width",t*(e.teamWidth+e.scoreWidth+e.roundMargin)+10):m.css("width",t*(e.teamWidth+e.scoreWidth+e.roundMargin)+40),h&&c.teams.length<=2&&!e.skipConsolationRound&&m.css("height",f+40)}function r(t){u.reset(),i.render(),o&&o.render(),a&&!e.skipGrandFinalComeback&&a.render(),e.disableHighlight||s(m,i,a),t&&(c.results[0]=i.results(),o&&(c.results[1]=o.results()),a&&!e.skipGrandFinalComeback&&(c.results[2]=a.results()),n(),e.save&&e.save(b(c),e.userData))}var i,o,a,u=new G,c=e.init,h=c.results.length<=1,f=45*c.teams.length+c.teams.length*e.matchMargin,m=t('<div class="jQBracket '+e.dir+'"></div>').appendTo(e.el.empty());e.skipSecondaryFinal&&h&&t.error("skipSecondaryFinal setting is viable only in double elimination mode"),e.disableToolbar||v(m,c,e);var y,C,E;h?C=t('<div class="bracket"></div>').appendTo(m):(e.skipGrandFinalComeback||(y=t('<div class="finals"></div>').appendTo(m)),C=t('<div class="bracket"></div>').appendTo(m),E=t('<div class="loserBracket"></div>').appendTo(m)),C.css("height",f),E&&E.css("height",C.height()/2),n();var k=function(t,e,n,i,o,s,a){return new L(t,e,n,i,o,s,a,u,m,r)};return i=new P(C,w.of(c.results[0]||null),k,!0,e),h||(o=new P(E,w.of(c.results[1]||null),k,!1,e),e.skipGrandFinalComeback||(a=new P(y,w.of(c.results[2]||null),k,!1,e))),l(i,c.teams,h,e,e.skipGrandFinalComeback&&!h),h||(p(i,o,c.teams.length,e.skipGrandFinalComeback,e.centerConnectors),e.skipGrandFinalComeback||d(a,i,o,e,m,n)),r(!1),{data:function(){return b(e.init)}}},H=function(t,e){if(t.hasOwnProperty(e)){var n=_typeof(t[e]);if("number"!==n)throw new Error('Option "'+e+'" is '+n+" instead of number")}},U=function(t,e){var n=t[e],r=void 0===n?"undefined":_typeof(n);if("boolean"!==r)throw new Error("Value of "+e+" must be boolean, got boolean, got "+r)},z=function(t,e,n){var r=e[n];if(r<t)throw new Error("Value of "+n+" must be greater than "+t+", got "+r)},Q=function(t){return t&t-1},V={init:function(e){var n=t.extend(!0,{},e);if(!n)throw Error("Options not set");if(!n.init&&!n.save)throw Error("No bracket data or save callback given");if(void 0===n.userData&&(n.userData=null),!(!n.decorator||n.decorator.edit&&n.decorator.render))throw Error("Invalid decorator input");n.decorator||(n.decorator={edit:a,render:u}),n.init||(n.init={results:[],teams:[[w.empty(),w.empty()]]}),n.el=this,n.save&&(n.onMatchClick||n.onMatchHover)&&t.error("Match callbacks may not be passed in edit mode (in conjunction with save callback)");var o=_typeof(n.disableToolbar),s=n.hasOwnProperty("disableToolbar");s&&"boolean"!==o&&t.error("disableToolbar must be a boolean, got "+o),!n.save&&s&&t.error('disableToolbar can be used only if the bracket is editable, i.e. "save" callback given'),s||(n.disableToolbar=void 0===n.save);var c=_typeof(n.disableTeamEdit),h=n.hasOwnProperty("disableTeamEdit");h&&"boolean"!==c&&t.error("disableTeamEdit must be a boolean, got "+c),!n.save&&h&&t.error('disableTeamEdit can be used only if the bracket is editable, i.e. "save" callback given'),h||(n.disableTeamEdit=!1),!n.disableToolbar&&n.disableTeamEdit&&t.error('disableTeamEdit requires also resizing to be disabled, initialize with "disableToolbar: true"');var l=i(n.init.results,4-r(n.init.results));n.init.results=S(l),H(n,"teamWidth"),H(n,"scoreWidth"),H(n,"roundMargin"),H(n,"matchMargin"),n.hasOwnProperty("teamWidth")||(n.teamWidth=70),n.hasOwnProperty("scoreWidth")||(n.scoreWidth=30),n.hasOwnProperty("roundMargin")||(n.roundMargin=40),n.hasOwnProperty("matchMargin")||(n.matchMargin=20),z(0,n,"teamWidth"),z(0,n,"scoreWidth"),z(0,n,"roundMargin"),z(0,n,"matchMargin"),n.hasOwnProperty("centerConnectors")||(n.centerConnectors=!1),U(n,"centerConnectors"),n.hasOwnProperty("disableHighlight")||(n.disableHighlight=!1),U(n,"disableHighlight");var p=Q(n.init.teams.length);p!==Math.floor(p)&&t.error('"teams" property must have 2^n number of team pairs, i.e. 1, 2, 4, etc. Got '+n.init.teams.length+" team pairs."),n.dir=n.dir||"lr",n.init.teams=n.init.teams&&0!==n.init.teams.length?n.init.teams:[[null,null]],n.init.teams=n.init.teams.map(function(t){return t.map(function(t){return null===t?w.empty():w.of(t)})}),n.skipConsolationRound=n.skipConsolationRound||!1,n.skipSecondaryFinal=n.skipSecondaryFinal||!1,"lr"!==n.dir&&"rl"!==n.dir&&t.error('Direction must be either: "lr" or "rl"');var d=j(n);return t(this).data("bracket",{target:this,obj:d}),d},data:function(){return t(this).data("bracket").obj.data()}};t.fn.bracket=function(e){return V[e]?V[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!==(void 0===e?"undefined":_typeof(e))&&e?void t.error("Method "+e+" does not exist on jQuery.bracket"):V.init.apply(this,arguments)}}(jQuery);