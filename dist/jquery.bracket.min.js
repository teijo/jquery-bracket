/* jQuery Bracket | Copyright (c) Teijo Laine 2011-2019 | Licenced under the MIT licence */

var EntryState,__assign=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t};!function(t){t.EMPTY_BYE="empty-bye",t.EMPTY_TBD="empty-tbd",t.ENTRY_NO_SCORE="entry-no-score",t.ENTRY_DEFAULT_WIN="entry-default-win",t.ENTRY_COMPLETE="entry-complete"}(EntryState||(EntryState={})),function(t){var e,n=function(){function t(e){if(this.val=e,e instanceof t)throw new Error("Trying to wrap Option into an Option");if(void 0===this.val)throw new Error("Option cannot contain undefined")}return t.of=function(e){return new t(e)},t.empty=function(){return new t(null)},t.prototype.get=function(){if(null===this.val)throw new Error("Trying to get() empty Option");return this.val},t.prototype.orElse=function(t){return null===this.val?t:this.val},t.prototype.orElseGet=function(t){return null===this.val?t():this.val},t.prototype.map=function(e){return null===this.val?t.empty():new t(e(this.val))},t.prototype.forEach=function(t){return null!==this.val&&t(this.val),this},t.prototype.toNull=function(){return null===this.val?null:this.val},t.prototype.isEmpty=function(){return null===this.val},t}(),r=function(){return function(t,e,n){if(this.first=t,this.second=e,this.matchData=n,!t||!e)throw new Error("Cannot create ResultObject with undefined scores")}}();(i=e||(e={}))[i.TBD=0]="TBD",i[i.BYE=1]="BYE",i[i.END=2]="END";var i,o=function(){function t(t){this.isFirst=t}return t.first=function(){return new t(!0)},t.second=function(){return new t(!1)},t.prototype.map=function(t,e){return this.isFirst?t:e},t}(),s=function(){function t(t,e,n,r,i){this.source=t,this.nameOrGetter=e,this.order=n,this.seed=r,this.score=i,this.sibling=function(){throw new Error("No sibling asigned")}}return Object.defineProperty(t.prototype,"name",{get:function(){return"function"==typeof this.nameOrGetter?this.nameOrGetter():this.nameOrGetter},set:function(t){this.nameOrGetter=t},enumerable:!0,configurable:!0}),t.prototype.emptyBranch=function(){if(!this.name.isEmpty())return this.sibling().name.isEmpty()?e.BYE:e.TBD;try{var t=this.source().emptyBranch();if(t===e.TBD)return e.TBD;if(t===e.END)return e.BYE;return this.source().sibling().emptyBranch()===e.TBD?e.TBD:e.BYE}catch(t){if(t instanceof c)return e.END;throw new Error('Unexpected exception type (message: "'+t.message+'")')}},t}();function a(t){return!isNaN(parseFloat(t))&&isFinite(t)}function c(){this.message="Root of information for this team",this.name="EndOfBranchException"}var h=function(){function t(t,e){this.a=t,this.b=e}return t.teamsInResultOrder=function(t){var n=t.a.name.isEmpty(),r=t.b.name.isEmpty();if(r&&!n)return t.b.emptyBranch()===e.BYE?[t.a,t.b]:[];if(n&&!r)return t.a.emptyBranch()===e.BYE?[t.b,t.a]:[];if(!t.a.score.isEmpty()&&!t.b.score.isEmpty()){if(t.a.score.get()>t.b.score.get())return[t.a,t.b];if(t.a.score.get()<t.b.score.get())return[t.b,t.a]}return[]},t.emptyTeam=function(t,e){var r=new s(t,n.empty(),n.empty(),n.empty(),n.empty());return r.sibling=function(){return e},r},t.prototype.winner=function(){return t.teamsInResultOrder(this)[0]||t.emptyTeam(this.a.source,this.b)},t.prototype.loser=function(){return t.teamsInResultOrder(this)[1]||t.emptyTeam(this.b.source,this.a)},t}();function u(e,n,r){var i=r.find(".jqteam[data-teamid="+e+"]"),o=n||"highlight";return{highlight:function(){i.each(function(){t(this).addClass(o),t(this).hasClass("win")&&t(this).parent().find(".connector").addClass(o)})},deHighlight:function(){i.each(function(){t(this).removeClass(o),t(this).parent().find(".connector").removeClass(o)})}}}function l(e,n,r){var i=t('<input type="text">');i.val(n),e.empty().append(i),i.focus(),i.blur(function(){r(i.val())}),i.keydown(function(t){var e=t.keyCode||t.which;9!==e&&13!==e&&27!==e||(t.preventDefault(),r(i.val(),27!==e))})}function d(t,e,n,r){switch(r){case EntryState.EMPTY_BYE:return void t.append("BYE");case EntryState.EMPTY_TBD:return void t.append("TBD");case EntryState.ENTRY_NO_SCORE:case EntryState.ENTRY_DEFAULT_WIN:case EntryState.ENTRY_COMPLETE:return t.append(e),void t.attr("title",e)}}function p(t){return t.el.find(".jqteam.win").append('<div class="bubble sf">SF</div>'),!0}function f(t){var e=t.el;e.find(".jqteam.win").append('<div class="bubble">1st</div>');return e.find(".jqteam.lose").append('<div class="bubble">2nd</div>'),!0}function m(t){var e=t.el;e.find(".jqteam.win").append('<div class="bubble third">3rd</div>');return e.find(".jqteam.lose").append('<div class="bubble fourth">4th</div>'),!0}var g=function(){throw new c},v=function(t,e){return function(){var r=new s(g,function(){return t[e][0]},n.of(o.first()),n.of(2*e),n.empty()),i=new s(g,function(){return t[e][1]},n.of(o.second()),n.of(2*e+1),n.empty());return r.sibling=function(){return i},i.sibling=function(){return r},[{source:function(){return r}},{source:function(){return i}}]}},b=function(t,e){return function(n){n.css("top","");var r=n.height();n.css({bottom:e?"":-r/2+"px",position:"absolute",top:e?t.el.height()/2-r/2+"px":""})}};var y=function(t,e,n,r,i,o){return function(){var r=n,i=0,s=1;return o%2==0&&(r=e-n-1,i=1,s=0),[{source:function(){return t.round(0).match(2*r+i).loser()}},{source:function(){return t.round(0).match(2*r+s).loser()}}]}},C=function(t,e,n,r,i,o,s){return function(){var i=o%2===(s+1)%2?n-r-1:r;return[{source:function(){return e.round(2*o).match(r).winner()}},{source:function(){return t.round(o+1).match(i).loser()}}]}},E=function(t,e){return function(){var n=e.el.height()/2-t.height()/2;return t.css({top:n})}},w=function(t){return function(e,n){var r=e.height()/4,i={height:0,shift:2*r};return n.winner().order.map(function(e){return e.map(t?i:{height:0,shift:r},t?i:{height:2*-r,shift:r})}).orElse(i)}};var k=function(){function e(e,n,r,i,o,s,a,c,h){this.bracket=e,this.previousRound=n,this.roundNumber=r,this.roundResults=i,this.doRenderCb=o,this.mkMatch=s,this.isFirstBracket=a,this.isLastRound=c,this.opts=h,this.containerWidth=this.opts.teamWidth+this.opts.scoreWidth,this.margin=this.isLastRound?this.opts.roundMargin+20:this.opts.roundMargin,this.roundCon=t('<div class="round" style="width: '+this.containerWidth+"px; margin-right: "+this.margin+'px"/>'),this.matches=[]}return Object.defineProperty(e.prototype,"el",{get:function(){return this.roundCon},enumerable:!0,configurable:!0}),e.prototype.addMatch=function(t,e){var r=this,i=this.matches.length,a=null!==t?t():[{source:function(){return r.bracket.round(r.roundNumber-1).match(2*i).winner()}},{source:function(){return r.bracket.round(r.roundNumber-1).match(2*i+1).winner()}}],c=function(){return a[0].source()},u=function(){return a[1].source()},l=new s(c,c().name,n.of(o.first()),c().seed,n.empty()),d=new s(u,u().name,n.of(o.second()),u().seed,n.empty());l.sibling=function(){return d},d.sibling=function(){return l};var p=new h(l,d),f=this.mkMatch(this,p,i,this.roundResults.map(function(t){return void 0===t[i]?null:t[i]}),e,this.isFirstBracket,this.opts);return this.matches.push(f),f},e.prototype.match=function(t){return this.matches[t]},e.prototype.prev=function(){return this.previousRound},e.prototype.size=function(){return this.matches.length},e.prototype.render=function(){this.roundCon.empty(),(this.doRenderCb.isEmpty()||this.doRenderCb.get()())&&(this.roundCon.appendTo(this.bracket.el),this.matches.forEach(function(t){return t.render()}))},e.prototype.results=function(){return this.matches.reduce(function(t,e){return t.concat([e.results()])},[])},e}(),T=function(){function t(t,e,n,r,i){this.bracketCon=t,this.initResults=e,this.mkMatch=n,this.isFirstBracket=r,this.opts=i,this.rounds=[]}return Object.defineProperty(t.prototype,"el",{get:function(){return this.bracketCon},enumerable:!0,configurable:!0}),t.prototype.addRound=function(t,e){var i=this.rounds.length,o=i>0?n.of(this.rounds[i-1]):n.empty(),s=this.initResults.map(function(t){return void 0===t[i]?new r(n.empty(),n.empty(),void 0):t[i]}),a=new k(this,o,i,s,e,this.mkMatch,this.isFirstBracket,t,this.opts);return this.rounds.push(a),a},t.prototype.dropRound=function(){this.rounds.pop()},t.prototype.round=function(t){return this.rounds[t]},t.prototype.size=function(){return this.rounds.length},t.prototype.final=function(){return this.rounds[this.rounds.length-1].match(0)},t.prototype.winner=function(){return this.rounds[this.rounds.length-1].match(0).winner()},t.prototype.loser=function(){return this.rounds[this.rounds.length-1].match(0).loser()},t.prototype.render=function(){this.bracketCon.empty();for(var t=0,e=this.rounds;t<e.length;t++){e[t].render()}},t.prototype.results=function(){return this.rounds.reduce(function(t,e){return t.concat([e.results()])},[])},t}(),M=function(t){return t<0?{height:-t,drop:!1}:t<2?{height:0,drop:!0}:{height:t,drop:!0}};function D(e){var n=t.extend(!0,{},e);return n.teams=n.teams.map(function(t){return t.map(function(t){return t.toNull()})}),n.results=n.results.map(function(t){return t.map(function(t){return t.map(function(t){return void 0!==t.matchData?[t.first.toNull(),t.second.toNull(),t.matchData]:[t.first.toNull(),t.second.toNull()]})})}),n}var R=function(){function t(){this.counter=0}return t.prototype.get=function(){return this.counter},t.prototype.getNext=function(){return++this.counter},t.prototype.reset=function(){this.counter=0},t}();function B(r,i,o,s,c,h,u,l,d,p){var f=o.name.isEmpty()||s.name.isEmpty()?"":'data-resultid="result-'+l.getNext()+'"',m=t('<div class="score" style="width: '+u.scoreWidth+'px;" '+f+"></div>"),g=o.name.isEmpty()||s.name.isEmpty()||!c?n.empty():o.score,v=u.extension.scoreToString(g.toNull());m.text(v);var b=t('<div class="jqteam" style="width: '+(u.teamWidth+u.scoreWidth)+'px;"></div>'),y=t('<div class="jqlabel" style="width: '+u.teamWidth+'px;"></div>').appendTo(b);u.decorator.render(y,o.name.toNull(),o.score.toNull(),(C=o,E=s,w=o.score,C.name.map(function(){return w.map(function(){return EntryState.ENTRY_COMPLETE}).orElseGet(function(){return E.emptyBranch()===e.BYE?EntryState.ENTRY_DEFAULT_WIN:EntryState.ENTRY_NO_SCORE})}).orElseGet(function(){var t=C.emptyBranch();switch(t){case e.BYE:return EntryState.EMPTY_BYE;case e.TBD:return EntryState.EMPTY_TBD;default:throw new Error("Unexpected branch type "+t)}})));var C,E,w;if(o.seed.forEach(function(t){b.attr("data-teamid",t)}),o.name.isEmpty()?b.addClass("na"):i.winner().name===o.name?b.addClass("win"):i.loser().name===o.name&&b.addClass("lose"),b.append(m),(!o.name.isEmpty()||o.name.isEmpty()&&0===r&&h)&&"function"==typeof u.save&&(u.disableTeamEdit||(y.addClass("editable"),y.click(function(){var e=t(this);!function i(){e.unbind(),u.decorator.edit(e,o.name.toNull(),function(s,a){var c=o.seed.get();u.init.teams[~~(c/2)][c%2]=n.of(s||null),p(!0),e.click(i);var h=u.el.find(".jqteam[data-teamid="+(c+1)+"] div.jqlabel:first");h.length&&!0===a&&0===r&&t(h).click()})}()})),!o.name.isEmpty()&&!s.name.isEmpty()&&c)){var k=l.get();m.addClass("editable"),m.click(function(){var e=t(this);!function r(){e.unbind();var i=a(o.score)?e.text():"0",s=t('<input type="text">');s.val(i),e.empty().append(s),s.focus().select(),s.keydown(function(e){a(t(this).val())?t(this).removeClass("error"):t(this).addClass("error");var n=e.keyCode||e.which;if(9===n||13===n||27===n){if(e.preventDefault(),t(this).blur(),27===n)return;var r=d.find("div.score[data-resultid=result-"+(k+1)+"]");r&&r.click()}}),s.blur(function(){var t=u.extension.evaluateScore(s.val(),o.score.toNull());null===t&&(t=o.score),e.html(t),a(t)&&(o.score=n.of(t),p(!0)),e.click(r)})}()})}return b}var N=function(){function e(e,r,i,o,s,c,h,u,l,d){if(this.round=e,this.match=r,this.seed=i,this.renderCb=s,this.isFirstBracket=c,this.opts=h,this.resultId=u,this.topCon=l,this.renderAll=d,this.connectorCb=n.empty(),this.matchUserData=o.isEmpty()?void 0:o.get().matchData,this.matchCon=t('<div class="match"></div>'),h.showMatchUserData){var p=this.matchUserData?this.matchUserData:h.userDataEmptyString;this.matchInfoCon=t('<div class="matchInfo" style="width: '+(h.teamWidth+h.scoreWidth)+'px;">'+p+"</div>")}if(this.teamCon=t('<div class="teamContainer"></div>'),this.alignCb=null,!h.save){var f=this.matchUserData;this.teamCon.hover(function(){h.onMatchHover(f,!0)},function(){h.onMatchHover(f,!1)}),this.teamCon.click(function(){h.onMatchClick(f)})}r.a.name=r.a.source().name,r.b.name=r.b.source().name,r.a.score=o.map(function(t){return t.first.toNull()}),r.b.score=o.map(function(t){return t.second.toNull()}),r.a.name&&r.b.name||!a(r.a.score)&&!a(r.b.score)||(console.warn("ERROR IN SCORE DATA: "+r.a.source().name+": "+r.a.score+", "+r.b.source().name+": "+r.b.score),r.a.score=r.b.score=n.empty())}return Object.defineProperty(e.prototype,"el",{get:function(){return this.matchCon},enumerable:!0,configurable:!0}),e.prototype.getRound=function(){return this.round},e.prototype.setConnectorCb=function(t){this.connectorCb=t},e.prototype.connect=function(e){var n=this,r="lr"===this.opts.dir?"right":"left",i=this.teamCon.height()/4,o=this.matchCon.height()/2,s=e.map(function(t){return t(n.teamCon,n)}).orElseGet(function(){return n.seed%2==0?n.winner().order.map(function(t){return t.map({height:o,shift:i*(n.opts.centerConnectors?2:1)},{height:o-i*(n.opts.centerConnectors?0:2),shift:i*(n.opts.centerConnectors?2:3)})}).orElse({height:o-i*(n.opts.centerConnectors?0:1),shift:2*i}):n.winner().order.map(function(t){return t.map({height:-o+i*(n.opts.centerConnectors?0:2),shift:-i*(n.opts.centerConnectors?2:3)},{height:-o,shift:-i*(n.opts.centerConnectors?2:1)})}).orElse({height:-o+i*(n.opts.centerConnectors?0:1),shift:2*-i})});this.teamCon.append(function(e,n,r){var i=n.shift,o=M(n.height),s=o.height,a=o.drop,c=e/2,h=i>=0,u=t('<div class="connector"></div>').css((d={},d[r]=-c-2,d.borderBottom=a?"none":"",d.borderTop=a?"":"none",d.bottom=h?"":-i-1,d.height=s,d.top=h?i-1:"",d.width=c,d)),l=t('<div class="connector"></div>').css((p={},p[r]=-c,p.bottom=a?0:"",p.top=a?"":0,p.width=c,p));return u.append(l);var d,p}(this.opts.roundMargin,s,r))},e.prototype.winner=function(){return this.match.winner()},e.prototype.loser=function(){return this.match.loser()},e.prototype.first=function(){return this.match.a},e.prototype.second=function(){return this.match.b},e.prototype.setAlignCb=function(t){this.alignCb=t},e.prototype.render=function(){var t=this;this.matchCon.empty(),this.teamCon.empty(),this.match.a.name=this.match.a.source().name,this.match.b.name=this.match.b.source().name,this.match.a.seed=this.match.a.source().seed,this.match.b.seed=this.match.b.source().seed;this.match.a.name.isEmpty()&&this.match.b.name.isEmpty()?this.teamCon.addClass("np"):this.match.winner().name?this.teamCon.removeClass("np"):this.teamCon.addClass("np");var e=!this.match.a.name.isEmpty()&&!this.match.b.name.isEmpty();this.teamCon.append(B(this.round.roundNumber,this.match,this.match.a,this.match.b,e,this.isFirstBracket,this.opts,this.resultId,this.topCon,this.renderAll)),this.teamCon.append(B(this.round.roundNumber,this.match,this.match.b,this.match.a,e,this.isFirstBracket,this.opts,this.resultId,this.topCon,this.renderAll)),this.matchCon.appendTo(this.round.el),this.opts.showMatchUserData&&this.matchCon.append(this.matchInfoCon),this.matchCon.append(this.teamCon);var n=this.round.bracket.el.height()/this.round.size();this.el.css({height:n});var r=this.el.height()/2-this.teamCon.height()/2;if(this.teamCon.css({top:r}),this.opts.showMatchUserData){var i=r+this.opts.userDataTopCorrection;this.matchInfoCon.css("top",i)}if(null!==this.alignCb){this.alignCb(this.teamCon);var o=this.teamCon.css("top");if(this.opts.showMatchUserData){var s=parseFloat(o.slice(0,-2))+this.opts.userDataTopCorrection;this.matchInfoCon.css({top:s})}}this.renderCb.map(function(e){return e(t)}).orElse(!1)||this.connect(this.connectorCb)},e.prototype.results=function(){return(this.match.a.name.isEmpty()||this.match.b.name.isEmpty())&&(this.match.a.score=this.match.b.score=n.empty()),new r(this.match.a.score,this.match.b.score,this.matchUserData)},e}(),F=function(t){return void 0===t?null:t},S=function(t){return t.map(function(t){return t.map(function(t){return t.map(function(t){return new r(n.of(F(t[0])),n.of(F(t[1])),t[2])})})})},O=function(e){var r=new R,i=e.init,o=i.results.length<=1,s=46*i.teams.length+i.teams.length*e.matchMargin,a=t('<div class="jQBracket '+e.dir+'"></div>').appendTo(e.el.empty());function c(){var t=function(t,e,n,r,i,o){if(e)return Math.log(2*t)/Math.log(2);if(n)return Math.max(2,2*(Math.log(2*t)/Math.log(2)-1)-1);if(i)return 2*(Math.log(2*t)/Math.log(2)-2)+2;var s=!r&&3===o.length&&2===o[2].length;return 2*(Math.log(2*t)/Math.log(2)-1)+1+(s?1:0)}(i.teams.length,o,e.skipGrandFinalComeback,e.skipSecondaryFinal,e.skipDoubleEliminationInSemiFinal,i.results),n=10;e.disableToolbar||(n+=30),e.skipDoubleEliminationInSemiFinal&&(n+=50),a.css({height:o&&i.teams.length<=2&&!e.skipConsolationRound?s+40:"",width:t*(e.teamWidth+e.scoreWidth+e.roundMargin)+n})}var h,l,d;function g(n){r.reset(),h.render(),l&&l.render(),d&&!e.skipGrandFinalComeback&&d.render(),e.disableHighlight||function(e,n,r){var i=r||n,o=i.winner(),s=i.loser();o&&s&&(o.name.isEmpty()||u(o.seed.get(),"highlightWinner",e).highlight(),s.name.isEmpty()||u(s.seed.get(),"highlightLoser",e).highlight()),e.find(".jqteam").mouseover(function(){var n=t(this).attr("data-teamid");if(void 0!==n){var r=u(parseInt(n,10),null,e);r.highlight(),t(this).mouseout(function(){r.deHighlight(),t(this).unbind("mouseout")})}})}(a,h,d),n&&(i.results[0]=h.results(),l&&(i.results[1]=l.results()),d&&!e.skipGrandFinalComeback&&(i.results[2]=d.results()),c(),e.save&&e.save(D(i),e.userData))}e.skipSecondaryFinal&&o&&t.error("skipSecondaryFinal setting is viable only in double elimination mode"),e.disableToolbar||a.append(function(e,r){var i=e.teams.length,o=e.results.length,s=t('<div class="tools"></div>');s.append(function(){return o=function(){for(var t=0;t<i;t+=1)e.teams.push([n.empty(),n.empty()]);return O(r)},t('<span class="increment">+</span>').click(o);var o}()),(i>1&&1===o||i>2&&3===o)&&s.append((a=function(){if(i>1)return e.teams=e.teams.slice(0,i/2),O(r)},t('<span class="decrement">-</span>').click(a)));var a;1===o&&i>1?s.append((h=function(){if(i>1&&o<3)return e.results.push([],[]),O(r)},t('<span class="doubleElimination">de</span>').click(h))):3===o&&i>1&&s.append((c=function(){if(3===o)return e.results=e.results.slice(0,1),O(r)},t('<span class="singleElimination">se</span>').click(c)));var c;var h;return s}(i,e));var k,M,B;o?M=t('<div class="bracket"></div>').appendTo(a):(e.skipGrandFinalComeback||(k=t('<div class="finals"></div>').appendTo(a),e.skipDoubleEliminationInSemiFinal&&k.css("margin-left","30px")),M=t('<div class="bracket"></div>').appendTo(a),B=t('<div class="loserBracket"></div>').appendTo(a)),M.css({height:s}),B&&B.css({height:s/2}),c();var F=function(t,e,n,i,o,s,c){return new N(t,e,n,i,o,s,c,r,a,g)};return h=new T(M,n.of(i.results[0]||null),F,!0,e),o||(l=new T(B,n.of(i.results[1]||null),F,!1,e),e.skipGrandFinalComeback||(d=new T(k,n.of(i.results[2]||null),F,!1,e))),function(t,e,r,i,o){for(var s,a=i.skipDoubleEliminationInSemiFinal?1:0,c=Math.log(2*e.length)/Math.log(2)-a,h=e.length,u=0;u<c;u+=1){s=t.addRound(!1,n.empty());for(var l=0;l<h;l+=1){var d=0===u?v(e,l):null;if(u===c-1&&r||u===c-1&&o)g=s.addMatch(d,n.of(f)),o||g.setAlignCb(b(g,i.skipConsolationRound));else if(i.skipDoubleEliminationInSemiFinal&&u===c-1){var g;(g=s.addMatch(d,n.of(p))).setConnectorCb(n.empty())}else s.addMatch(d,n.empty())}h/=2}if(r&&(t.final().setConnectorCb(n.empty()),e.length>1&&!i.skipConsolationRound)){var y=t.final().getRound().prev(),C=y.map(function(t){return function(){return t.match(0).loser()}}).toNull(),E=y.map(function(t){return function(){return t.match(1).loser()}}).toNull(),w=s.addMatch(function(){return[{source:C},{source:E}]},n.of(m));w.setAlignCb(function(e){var n=t.el.height()/2;w.el.css({height:n});var r=e.height()/2+i.matchMargin;e.css({top:r})}),w.setConnectorCb(n.empty())}}(h,i.teams,o,e,e.skipGrandFinalComeback&&!o),o||(function(t,e,r,i,o,s){for(var a=o?1:0,c=Math.log(2*r)/Math.log(2)-1-a,h=r/2,u=0;u<c;u+=1){for(var l=i&&u===c-1?1:2,d=0;d<l;d+=1)for(var f=e.addRound(!1,n.empty()),g=0;g<h;g+=1){var v=d%2==0?0===u?y(t,h,g,d,u,c):null:C(t,e,h,g,d,u,c),b=u===c-1&&i,k=u===c-1&&d===l-1&&o,T=f.addMatch(v,n.of(k?p:b?m:null));if(T.setAlignCb(E(T.el.find(".teamContainer"),T)),b||k)T.setConnectorCb(n.empty());else if(u<c-1||d<1){var M=d%2==0?w(s):null;T.setConnectorCb(n.of(M))}}h/=2}}(h,l,i.teams.length,e.skipGrandFinalComeback,e.skipDoubleEliminationInSemiFinal,e.centerConnectors),e.skipGrandFinalComeback||(e.skipDoubleEliminationInSemiFinal?function(t,e,r,i,o){var s=t.addRound(!1,n.empty()),a=e.size()-1,c=r.size()-1,h=e.round(a).match(0),u=e.round(a).match(1),l=r.round(c).match(0),d=r.round(c).match(1),p=s.addMatch(function(){return[{source:function(){return h.winner()}},{source:function(){return l.winner()}}]},n.empty());p.setAlignCb(function(t){var n=e.el.height()/i.init.teams.length;p.el.css({height:n}),t.css({top:40})});var g=s.addMatch(function(){return[{source:function(){return u.winner()}},{source:function(){return d.winner()}}]},n.empty());g.setAlignCb(function(t){var n=e.el.height()/i.init.teams.length;g.el.css({height:n}),t.css({top:40})});var v=t.addRound(!0,n.empty()),b=v.addMatch(function(){return[{source:function(){return p.winner()}},{source:function(){return g.winner()}}]},n.of(f));if(b.setAlignCb(function(t){var n=e.el.height()/i.init.teams.length;b.el.css({height:n});var r=40+b.el.height()/2;t.css({top:r})}),!i.skipConsolationRound){var y=v.addMatch(function(){return[{source:function(){return p.loser()}},{source:function(){return g.loser()}}]},n.of(m));y.setAlignCb(function(t){var n=e.el.height()/i.init.teams.length;y.el.css({height:n});var r=40+y.el.height();t.css({top:r})})}o()}(d,h,l,e,c):function(t,e,r,i,o){var s=t.addRound(!1,n.empty()),a=s.addMatch(function(){return[{source:function(){return e.winner()}},{source:function(){return r.winner()}}]},n.of(function(s){var a=!1;if(i.skipSecondaryFinal||s.winner().name.isEmpty()||s.winner().name!==r.winner().name){if(2===t.size())t.dropRound();else if(t.size()>2)throw new Error("Unexpected number of final rounds");return f(s)}if(2===t.size())return!1;var c=t.addRound(!1,n.of(function(){var e=!s.winner().name.isEmpty()&&s.winner().name===r.winner().name;return!1===a&&e&&(a=!0,o()),!e&&a&&(a=!1,t.dropRound(),o()),e})).addMatch(function(){return[{source:function(){return s.first()}},{source:function(){return s.second()}}]},n.of(f));return s.setConnectorCb(n.of(function(t){return{height:0,shift:t.height()/2}})),c.setConnectorCb(n.empty()),c.setAlignCb(function(t){var n=e.el.height()+r.el.height();c.el.css({height:n});var i=(e.el.height()/2+e.el.height()+r.el.height()/2)/2-t.height();t.css({top:i})}),!1}));if(a.setAlignCb(function(t){var n=(e.el.height()+r.el.height())/(i.skipConsolationRound?1:2);a.el.css({height:n});var o=(e.el.height()/2+e.el.height()+r.el.height()/2)/2-t.height();t.css({top:o})}),!i.skipConsolationRound){var c=r.final().getRound().prev(),h=s.addMatch(function(){return[{source:function(){return c.get().match(0).loser()}},{source:function(){return r.loser()}}]},n.of(m));h.setAlignCb(function(t){var n=(e.el.height()+r.el.height())/2;h.el.css({height:n});var i=(e.el.height()/2+e.el.height()+r.el.height()/2)/2+t.height()/2-n;t.css({top:i})}),a.setConnectorCb(n.empty()),h.setConnectorCb(n.empty())}e.final().setConnectorCb(n.of(function(t){var n=t.height()/4,o=(e.el.height()/2+e.el.height()+r.el.height()/2)/2-t.height()/2-e.el.height()/2,s=e.winner().order.map(function(t){return t.map({height:o+2*n,shift:n*(i.centerConnectors?2:1)},{height:o+n*(i.centerConnectors?2:0),shift:n*(i.centerConnectors?2:3)})}).orElse({height:o+n*(i.centerConnectors?2:1),shift:2*n}),a=s.height,c=s.shift;return{height:a-t.height()/2,shift:c}})),r.final().setConnectorCb(n.of(function(t){var n=t.height()/4,o=(e.el.height()/2+e.el.height()+r.el.height()/2)/2-t.height()/2-e.el.height()/2,s=r.winner().order.map(function(t){return t.map({height:o+n*(i.centerConnectors?2:0),shift:n*(i.centerConnectors?2:3)},{height:o+2*n,shift:n*(i.centerConnectors?2:1)})}).orElse({height:o+n*(i.centerConnectors?2:1),shift:2*n}),a=s.height,c=s.shift;return{height:-(a+t.height()/2),shift:-c}}))}(d,h,l,e,c))),g(!1),e.headersForSubBrackets&&(t('<div class="losersheader"><p>Losers</p></div>').prependTo(B),t('<div class="finalsheader"><p>Finals</p></div>').prependTo(k),t('<div style="height: '+(h.el.height()+l.el.height()+10)+'px;"><div>').appendTo(k)),{data:function(){return D(e.init)}}};var x=function(t){if("boolean"!=typeof t)throw new Error("Value is not a boolean");return t},Y=function(t){var e=function(t){if("number"!=typeof t)throw new Error("Value is not a number");return t}(t);if(e<t)throw new Error("Value must be greater than "+t+", got "+e);return e},I=function(t){return t&t-1};function _(e,r,i){var o={centerConnectors:!!e.hasOwnProperty("centerConnectors")&&x(e.centerConnectors),decorator:e.decorator,dir:function(t){{if(void 0===t)return"lr";if("lr"!==t&&"rl"!==t)throw new Error('Direction must be either: "lr" or "rl"');return t}}(e.dir),disableHighlight:!!e.hasOwnProperty("disableHighlight")&&x(e.disableHighlight),disableTeamEdit:!!e.hasOwnProperty("disableTeamEdit")&&x(e.disableTeamEdit),disableToolbar:e.disableToolbar,el:r,extension:i,init:function(e){var r=e||{results:[],teams:[[null,null]]};if(void 0===r.teams)throw new Error("Teams missing");if(void 0===r.results)throw new Error("Results missing");var i=I(r.teams.length);i!==Math.floor(i)&&t.error('"teams" property must have 2^n number of team pairs, i.e. 1, 2, 4, etc. Got '+r.teams.length+" team pairs.");var o=function t(e,n){return n>0&&(e=t([e],n-1)),e}(r.results,4-(s=r.results,function t(e,n){return e instanceof Array?t(e[0],n+1):n}(s,0)));var s;return{results:S(o),teams:r.teams&&0!==r.teams.length?r.teams.map(function(t){return t.map(function(t){return null===t?n.empty():n.of(t)})}):[[n.empty(),n.empty()]]}}(e.init),matchMargin:e.hasOwnProperty("matchMargin")?Y(e.matchMargin):20,onMatchClick:e.onMatchClick?e.onMatchClick:function(){},onMatchHover:e.onMatchHover?e.onMatchHover:function(){},roundMargin:e.hasOwnProperty("roundMargin")?Y(e.roundMargin):40,save:e.save,scoreWidth:e.hasOwnProperty("scoreWidth")?Y(e.scoreWidth):30,skipConsolationRound:e.skipConsolationRound||!1,skipGrandFinalComeback:e.skipGrandFinalComeback||!1,skipSecondaryFinal:e.skipSecondaryFinal||!1,skipDoubleEliminationInSemiFinal:e.skipDoubleEliminationInSemiFinal||!1,headersForSubBrackets:e.headersForSubBrackets||!1,showMatchUserData:e.showMatchUserData||!1,userDataTopCorrection:e.userDataTopCorrection||0,userDataEmptyString:e.userDataEmptyString||"-",teamWidth:e.hasOwnProperty("teamWidth")?Y(e.teamWidth):70,userData:e.userData};!(s=o).save&&s.disableTeamEdit&&t.error('disableTeamEdit can be used only if the bracket is editable, i.e. "save" callback given'),!s.disableToolbar&&s.disableTeamEdit&&t.error('disableTeamEdit requires also resizing to be disabled, initialize with "disableToolbar: true"');var s;return o}function j(t,e){return t&&a(t)||a(e)?a(t)?parseInt(t,10):null:0}t.fn.bracket=function(e){if("string"==typeof e&&"data"===e){return t(this).data("bracket").obj.data()}if("object"==typeof(r=e)||void 0===r){var n=e;return function(e,n,r){if(!n)throw Error("Options not set");if(!n.init&&!n.save)throw Error("No bracket data or save callback given");var i=t.extend(!0,{},n);if(i.decorator&&(!i.decorator.edit||!i.decorator.render))throw Error("Invalid decorator input");i.save&&(i.onMatchClick||i.onMatchHover)&&t.error("Match callbacks may not be passed in edit mode (in conjunction with save callback)");var o=typeof i.disableToolbar,s=i.hasOwnProperty("disableToolbar");s&&"boolean"!==o&&t.error("disableToolbar must be a boolean, got "+o),!i.save&&s&&t.error('disableToolbar can be used only if the bracket is editable, i.e. "save" callback given'),s||(i.disableToolbar=void 0===i.save);var a=_(i,e,r),c=O(a);return t(e).data("bracket",{target:e,obj:c}),c}(this,__assign({},n,{decorator:n.decorator?n.decorator:{edit:l,render:d}}),{evaluateScore:j,scoreToString:function(t){return null===t?"--":t.toString()}})}t.error("Method "+e+" does not exist on jQuery.bracket");var r}}(jQuery);